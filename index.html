<!doctype html>
<html><head>
	<title>Tap</title>
	<style>body{margin:0;padding:0;text-align:center;background-color:rgb(51,51,51);cursor:pointer;}</style>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.2.0/p5.min.js"></script>
	<script>let mode_=-1;const MODE_READY=-1,MODE_GAME=0,MODE_REPLAY=1,MODE_GAMEOVER=2;let frame=0,count=0,accuracy=0;const grid=4;let res,lastclick,tiles=[];class Tile{constructor(e,t){this.x=e,this.y=t+height/6,this.state=!1}show(){push(),stroke(51,100),fill(this.state?0:255,100),rect(this.x,this.y,res-1,res-1),pop()}}function setup(){let e=window.innerHeight-5,t=.75*e;console.log("Resolution:",t,e),frameRate(60),createCanvas(t,e),res=width/grid,setTimeout(resetGame,2e3)}function draw(){if(mode_==MODE_READY)push(),background(0,4),fill(255),textAlign(CENTER),textSize(32),text("GET READY...",width/2,height/3),textSize(18),text("SHOOT AS MANY TARGETS AS YOU CAN\nIN SHORTEST TIME",width/2,height/2.5),pop();else if(mode_==MODE_GAME){push(),fill(0,0,255),rect(0,0,width,height/6),textSize(width/32),fill(255),text(`${count} targets in ${Math.floor(frame/60)} seconds (${(count/Math.floor(frame/60)||0).toFixed(2)} t/s)`,width/4,height/6/3),text(`Accuracy: ${Math.round(accuracy/count/(res/2)*100)||0}%`,width/4,height/6/2),pop();for(let e of tiles)e.show();push(),fill(0,0,255),rect(0,height/6+4*res,width,height-height/6+4*res),pop(),saveHistory(),frame++}else if(mode_==MODE_REPLAY){let e=frame%history.length;e==history.length-1&&(noLoop(),setTimeout(()=>{loop()},2e3)),loadHistory(e),frame++}else mode_==MODE_GAMEOVER&&(push(),background(255,0,0,32),textAlign(CENTER),textSize(32),text("GAME OVER",width/2,height/2),pop())}function mousePressed(){if(mode_==MODE_GAME){lastclick=createVector(mouseX,mouseY);for(let e of tiles){let t=e.x,s=e.y;mouseX>=t&&mouseX<=t+res&&mouseY>=s&&mouseY<=s+res&&(e.state?(push(),fill(0,255,0),rect(e.x,e.y,res,res),pop(),accuracy+=dist(mouseX,mouseY,e.x+res/2,e.y+res/2),count++,generateTiles(1),e.state=!1):(push(),fill(255,0,0),rect(e.x,e.y,res,res),pop(),mode_=MODE_GAMEOVER,setTimeout(()=>{mode_=MODE_REPLAY,frame=0},500),console.log(`${count} targets in ${Math.floor(frame/60)} seconds (${(count/Math.floor(frame/60)).toFixed(2)})`),console.log(`Accuracy: ${Math.round(accuracy/count/(res/2)*100)}%.`)))}}else mode_==MODE_REPLAY&&mouseX>=0&&mouseX<=width&&mouseY>=height/6+4*res&&mouseY<=height-height/6+4*res&&(background(255),mode_=MODE_READY,setTimeout(resetGame,2e3))}function resetGame(){tiles=[],history=[],frame=0,mode_=MODE_GAME,count=0,accuracy=0,lastclick=null;for(let e=0;e<grid;e++)for(let t=0;t<grid;t++)tiles.push(new Tile(res*e,res*t));generateTiles(4)}function generateTiles(e){for(let t=0;t<e;t++){let e=random(tiles);1==e.state&&t--,e.state=!0}}let history=[];function saveHistory(){history.push({tiles:tiles.filter(e=>e.state),prevpos:createVector(pmouseX,pmouseY),pos:createVector(mouseX,mouseY),lastclick:lastclick||createVector(-5,-5),count:count,accuracy:accuracy})}function loadHistory(e){push(),fill(0,0,255),rect(0,0,width,height/6),textSize(width/32),fill(255),text(`${history[e].count} targets in ${Math.floor(e/60)} seconds (${(history[e].count/Math.floor(e/60)||0).toFixed(2)} t/s)`,width/4,height/6/3),text(`Accuracy: ${Math.round(history[e].accuracy/history[e].count/(res/2)*100)||0}%`,width/4,height/6/2),fill(255,0,0),text("REPLAY...",5,height/6-5),pop(),push(),fill(0,0,10*frameCount%255),rect(0,height/6+4*res,width,height-height/6+4*res),textAlign(CENTER),textSize(height/32),fill(255,0,0),text("PLAY AGAIN",width/2,height-25),pop(),push(),fill(255,100),stroke(0);for(let e=0;e<grid;e++)for(let t=0;t<grid;t++)rect(e*res,t*res+height/6,res-1,res-1);pop(),push(),stroke(255),fill(0,128);for(let t of history[e].tiles)rect(t.x,t.y,res-1,res-1);pop(),push(),fill(0,255,0),noStroke(),ellipse(history[e].pos.x,history[e].pos.y,16,16),stroke(0,255,0),strokeWeight(16),line(history[e].prevpos.x,history[e].prevpos.y,history[e].pos.x,history[e].pos.y),pop(),push(),stroke(0,128,0),fill(0,255,0),history[e].lastclick&&ellipse(history[e].lastclick.x,history[e].lastclick.y,8,8),pop(),push(),stroke(255,0,0),strokeWeight(10),line(0,height,map(e,0,history.length,0,width),height),pop(),e==history.length-1&&(push(),stroke(255,0,0),strokeWeight(4),line(history[e].pos.x-8,history[e].pos.y-8,history[e].pos.x+8,history[e].pos.y+8),line(history[e].pos.x-8,history[e].pos.y+8,history[e].pos.x+8,history[e].pos.y-8),pop())}</script>
</head></html>